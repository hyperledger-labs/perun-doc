<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1191px" preserveAspectRatio="none" style="width:724px;height:1191px;" version="1.1" viewBox="0 0 724 1191" width="724px" zoomAndPan="magnify"><defs><filter height="300%" id="f1euypcp2vs4sb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1euypcp2vs4sb)" height="1080.4609" style="stroke:#000000;stroke-width:2.0;" width="702" x="8" y="84.8906"/><rect fill="#FFFFFF" filter="url(#f1euypcp2vs4sb)" height="81.5313" style="stroke:#000000;stroke-width:2.0;" width="256" x="284" y="330.3516"/><rect fill="#FFFFFF" filter="url(#f1euypcp2vs4sb)" height="414.2031" style="stroke:#000000;stroke-width:2.0;" width="552" x="27" y="424.8828"/><rect fill="#FFFFFF" height="111.2031" style="stroke:none;stroke-width:1.0;" width="552" x="27" y="727.8828"/><rect fill="#FFFFFF" filter="url(#f1euypcp2vs4sb)" height="185.4688" style="stroke:#000000;stroke-width:2.0;" width="508" x="46" y="523.4141"/><rect fill="#FFFFFF" height="56.9375" style="stroke:none;stroke-width:1.0;" width="508" x="46" y="651.9453"/><rect fill="#FFFFFF" filter="url(#f1euypcp2vs4sb)" height="250" style="stroke:#000000;stroke-width:2.0;" width="558" x="108" y="852.0859"/><rect fill="#FFFFFF" height="116.3359" style="stroke:none;stroke-width:1.0;" width="558" x="108" y="985.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="124" x2="124" y1="72.8906" y2="1184.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="300" x2="300" y1="72.8906" y2="1184.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="524" x2="524" y1="72.8906" y2="1184.3516"/><rect fill="#FEFECE" filter="url(#f1euypcp2vs4sb)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="87" x="78.5" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="106" y="41.292">Alice</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="85.5" y="57.5889">(Proposer)</text><rect fill="#FEFECE" filter="url(#f1euypcp2vs4sb)" height="62.8906" style="stroke:#A80036;stroke-width:1.5;" width="104" x="246" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="38" x="279" y="24.9951">Ingrid</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="264" y="41.292">(Common</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="253" y="57.5889">Intermediary)</text><rect fill="#FEFECE" filter="url(#f1euypcp2vs4sb)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="91" x="476.5" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="508" y="41.292">Bob</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="483.5" y="57.5889">(Proposee)</text><path d="M8,84.8906 L78,84.8906 L78,91.8906 L68,101.8906 L8,101.8906 L8,84.8906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1080.4609" style="stroke:#000000;stroke-width:2.0;" width="702" x="8" y="84.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="23" y="97.9575">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="93" y="97.1011">[if latest off-chain state is finalized]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="124" x2="166" y1="203.8203" y2="203.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="166" x2="166" y1="203.8203" y2="216.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="125" x2="166" y1="216.8203" y2="216.8203"/><polygon fill="#A80036" points="135,212.8203,125,216.8203,135,220.8203,131,216.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="131" y="123.0903">Generate an update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="131" y="138.2231">parent ledger channel 1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="131" y="153.356">(between alice &amp;ingrid)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="131" y="168.4888">that unlocks the funds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="131" y="183.6216">for the virtual channel ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="131" y="198.7544">as per final balance</text><line style="stroke:#A80036;stroke-width:1.0;" x1="524" x2="566" y1="203.8203" y2="203.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="566" x2="566" y1="203.8203" y2="216.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="566" y1="216.8203" y2="216.8203"/><polygon fill="#A80036" points="535,212.8203,525,216.8203,535,220.8203,531,216.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="531" y="123.0903">Generate an update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="531" y="138.2231">parent ledger channel 2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="531" y="153.356">(between bob &amp;ingrid)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="531" y="168.4888">that unlocks the funds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="531" y="183.6216">for the virtual channel ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="531" y="198.7544">as per final balance</text><polygon fill="#A80036" points="288,257.0859,298,261.0859,288,265.0859,292,261.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="124" x2="294" y1="261.0859" y2="261.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="136" y="240.8872">Send the update on the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="136" y="256.02">parent ledger channel 1</text><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="342" y1="305.3516" y2="305.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="342" y1="305.3516" y2="318.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="301" x2="342" y1="318.3516" y2="318.3516"/><polygon fill="#A80036" points="311,314.3516,301,318.3516,311,322.3516,307,318.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="307" y="285.1528">Wait for matching</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="307" y="300.2856">update from Bob</text><path d="M284,330.3516 L354,330.3516 L354,337.3516 L344,347.3516 L284,347.3516 L284,330.3516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="81.5313" style="stroke:#000000;stroke-width:2.0;" width="256" x="284" y="330.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="299" y="343.4185">opt</text><polygon fill="#A80036" points="311,399.8828,301,403.8828,311,407.8828,307,403.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="305" x2="523" y1="403.8828" y2="403.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="353.5" y="368.5513">(Matching update)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="336" y="383.6841">Send the update on the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="336" y="398.8169">parent ledger channel 2</text><path d="M27,424.8828 L97,424.8828 L97,431.8828 L87,441.8828 L27,441.8828 L27,424.8828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="414.2031" style="stroke:#000000;stroke-width:2.0;" width="552" x="27" y="424.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="42" y="437.9497">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="378" x="112" y="437.0933">[when matching update is received withing expected time]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="27" x2="579" y1="728.8828" y2="728.8828"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="32" y="739.0933">[else]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="342" y1="498.4141" y2="498.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="342" y1="498.4141" y2="511.4141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="301" x2="342" y1="511.4141" y2="511.4141"/><polygon fill="#A80036" points="311,507.4141,301,511.4141,311,515.4141,307,511.4141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="307" y="463.0825">Validate the two updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="307" y="478.2153">(Finalized state of virtual channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="307" y="493.3481">in both must match)</text><path d="M46,523.4141 L116,523.4141 L116,530.4141 L106,540.4141 L46,540.4141 L46,523.4141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="185.4688" style="stroke:#000000;stroke-width:2.0;" width="508" x="46" y="523.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="61" y="536.481">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="131" y="535.6245">[if valid]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="46" x2="554" y1="652.9453" y2="652.9453"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="51" y="663.1558">[else]</text><path d="M67,550.5469 L67,590.5469 L529,590.5469 L529,560.5469 L519,550.5469 L67,550.5469 " fill="#D3D3D3" filter="url(#f1euypcp2vs4sb)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M519,550.5469 L519,560.5469 L529,560.5469 L519,550.5469 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="402" x="73" y="567.6138">Both participants have already finalized the virtual channel. So,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="73" y="582.7466">automatically accept both updates without involving the user (ingrid).</text><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="342" y1="620.9453" y2="620.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="342" y1="620.9453" y2="633.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="301" x2="342" y1="633.9453" y2="633.9453"/><polygon fill="#A80036" points="311,629.9453,301,633.9453,311,637.9453,307,633.9453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="307" y="615.8794">Accept</text><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="342" y1="687.8828" y2="687.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="342" y1="687.8828" y2="700.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="301" x2="342" y1="700.8828" y2="700.8828"/><polygon fill="#A80036" points="311,696.8828,301,700.8828,311,704.8828,307,700.8828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="307" y="682.8169">Reject</text><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="342" y1="763.8203" y2="763.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="342" x2="342" y1="763.8203" y2="776.8203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="301" x2="342" y1="776.8203" y2="776.8203"/><polygon fill="#A80036" points="311,772.8203,301,776.8203,311,780.8203,307,776.8203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="307" y="758.7544">Reject</text><path d="M58,789.8203 L58,829.8203 L538,829.8203 L538,799.8203 L528,789.8203 L58,789.8203 " fill="#D3D3D3" filter="url(#f1euypcp2vs4sb)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M528,789.8203 L528,799.8203 L538,799.8203 L528,789.8203 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="64" y="806.8872">For the participant from whom update was received, reject immediately.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419" x="64" y="822.02">For other participants, reject when a matching update is received.</text><path d="M108,852.0859 L172,852.0859 L172,859.0859 L162,869.0859 L108,869.0859 L108,852.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="250" style="stroke:#000000;stroke-width:2.0;" width="558" x="108" y="852.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="123" y="865.1528">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="187" y="864.2964">[if accept]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="108" x2="666" y1="986.75" y2="986.75"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="113" y="996.9604">[if reject]</text><polygon fill="#A80036" points="135,906.4844,125,910.4844,135,914.4844,131,910.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="129" x2="299" y1="910.4844" y2="910.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="143" y="890.2856">Accept the update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="136" y="905.4185">parent ledger channel 1</text><polygon fill="#A80036" points="512,906.4844,522,910.4844,512,914.4844,516,910.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="518" y1="910.4844" y2="910.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="343" y="890.2856">Accept the update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="336" y="905.4185">parent ledger channel 2</text><line style="stroke:#A80036;stroke-width:1.0;" x1="124" x2="166" y1="954.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="166" x2="166" y1="954.75" y2="967.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="125" x2="166" y1="967.75" y2="967.75"/><polygon fill="#A80036" points="135,963.75,125,967.75,135,971.75,131,967.75" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="131" y="934.5513">Virtual channel is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="131" y="949.6841">withdrawn for alice</text><line style="stroke:#A80036;stroke-width:1.0;" x1="524" x2="566" y1="954.75" y2="954.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="566" x2="566" y1="954.75" y2="967.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="566" y1="967.75" y2="967.75"/><polygon fill="#A80036" points="535,963.75,525,967.75,535,971.75,531,967.75" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="531" y="934.5513">Virtual channel is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="531" y="949.6841">withdrawn for bob</text><polygon fill="#A80036" points="135,1032.8203,125,1036.8203,135,1040.8203,131,1036.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="129" x2="299" y1="1036.8203" y2="1036.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="145.5" y="1016.6216">Reject the update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="136" y="1031.7544">parent ledger channel 1</text><polygon fill="#A80036" points="512,1032.8203,522,1036.8203,512,1040.8203,516,1036.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="300" x2="518" y1="1036.8203" y2="1036.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="345.5" y="1016.6216">Reject the update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="336" y="1031.7544">parent ledger channel 2</text><line style="stroke:#A80036;stroke-width:1.0;" x1="124" x2="166" y1="1081.0859" y2="1081.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="166" x2="166" y1="1081.0859" y2="1094.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="125" x2="166" y1="1094.0859" y2="1094.0859"/><polygon fill="#A80036" points="135,1090.0859,125,1094.0859,135,1098.0859,131,1094.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="131" y="1060.8872">Virtual channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="131" y="1076.02">withdrawal failed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="524" x2="566" y1="1081.0859" y2="1081.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="566" x2="566" y1="1081.0859" y2="1094.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525" x2="566" y1="1094.0859" y2="1094.0859"/><polygon fill="#A80036" points="535,1090.0859,525,1094.0859,535,1098.0859,531,1094.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="531" y="1060.8872">Virtual channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="531" y="1076.02">withdrawal failed</text><path d="M82.5,1116.0859 L82.5,1156.0859 L565.5,1156.0859 L565.5,1126.0859 L555.5,1116.0859 L82.5,1116.0859 " fill="#D3D3D3" filter="url(#f1euypcp2vs4sb)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M555.5,1116.0859 L555.5,1126.0859 L565.5,1126.0859 L555.5,1116.0859 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="161.5" y="1133.1528">In this case, the virtual channel should be settled</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="161.5" y="1148.2856">by registering a dispute on the blockchain.</text><!--MD5=[c2e931ceade3cdbec9577918fcf406c8]
@startuml settle_virtual
!pragma teoz true
hide footbox
skinparam SequenceMessageAlign center

participant "Alice\n(Proposer)" as alice
participant "Ingrid\n(Common\nIntermediary)" as ingrid
participant "Bob\n(Proposee)" as bob

opt if latest off-chain state is finalized
alice -> alice: Generate an update on\nparent ledger channel 1\n(between alice &ingrid)\nthat unlocks the funds\nfor the virtual channel ID\nas per final balance
&bob -> bob: Generate an update on\nparent ledger channel 2\n(between bob &ingrid)\nthat unlocks the funds\nfor the virtual channel ID\nas per final balance

alice -> ingrid: Send the update on the\nparent ledger channel 1

ingrid -> ingrid: Wait for matching\nupdate from Bob
opt
ingrid <- bob: (Matching update)\nSend the update on the\nparent ledger channel 2
end

opt when matching update is received withing expected time
ingrid -> ingrid: Validate the two updates\n(Finalized state of virtual channel\nin both must match)
opt if valid
note over ingrid #LightGray
Both participants have already finalized the virtual channel. So,
automatically accept both updates without involving the user (ingrid).
end note
ingrid -> ingrid: Accept
else else
ingrid -> ingrid: Reject
end

else else
ingrid -> ingrid: Reject
note over ingrid #LightGray
For the participant from whom update was received, reject immediately.
For other participants, reject when a matching update is received.
end note
end

alt if accept
alice <- ingrid: Accept the update on\nparent ledger channel 1
&ingrid -> bob: Accept the update on\nparent ledger channel 2

alice -> alice: Virtual channel is\nwithdrawn for alice
&bob -> bob: Virtual channel is\nwithdrawn for bob

else if reject
alice <- ingrid: Reject the update on\nparent ledger channel 1
&ingrid -> bob: Reject the update on\nparent ledger channel 2

alice -> alice: Virtual channel \nwithdrawal failed
&bob -> bob: Virtual channel \nwithdrawal failed
end
note over alice, bob #LightGray
In this case, the virtual channel should be settled
by registering a dispute on the blockchain.
end note

end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>