<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="640px" preserveAspectRatio="none" style="width:540px;height:640px;" version="1.1" viewBox="0 0 540 640" width="540px" zoomAndPan="magnify"><defs><filter height="300%" id="f1h2btuo4y9hlz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="109" x="217.5" y="28.708">Settle Phase</text><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="281.0469"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="578.8438"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="132.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="237.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="159.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="237.5" y="449.3125"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="132.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="485.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="159.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="485.5" y="449.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38" x2="38" y1="123.25" y2="351.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="38" x2="38" y1="351.0469" y2="379.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="38" x2="38" y1="379.0469" y2="633.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="242" x2="242" y1="123.25" y2="351.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="242" x2="242" y1="351.0469" y2="379.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="242" x2="242" y1="379.0469" y2="633.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="490" x2="490" y1="123.25" y2="351.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="490" x2="490" y1="351.0469" y2="379.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="490" x2="490" y1="379.0469" y2="633.8438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="20" y="119.9482">user</text><ellipse cx="38.5" cy="49.9531" fill="#FEFECE" filter="url(#f1h2btuo4y9hlz)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M38.5,57.9531 L38.5,84.9531 M25.5,65.9531 L51.5,65.9531 M38.5,84.9531 L25.5,99.9531 M38.5,84.9531 L51.5,99.9531 " fill="none" filter="url(#f1h2btuo4y9hlz)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="199" y="119.9482">perun node</text><ellipse cx="242.5" cy="90.9531" fill="#FEFECE" filter="url(#f1h2btuo4y9hlz)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="230.5" x2="254.5" y1="104.9531" y2="104.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="473" y="119.9482">SDK</text><ellipse cx="490.5" cy="90.9531" fill="#FEFECE" filter="url(#f1h2btuo4y9hlz)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="478.5" x2="502.5" y1="104.9531" y2="104.9531"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="281.0469"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="33.5" y="578.8438"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="132.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="237.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="159.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="237.5" y="449.3125"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="132.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="485.5" y="178.5156"/><rect fill="#FAFAD2" filter="url(#f1h2btuo4y9hlz)" height="159.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="485.5" y="449.3125"/><path d="M10,140.25 L463,140.25 L463,147.25 L453,157.25 L10,157.25 L10,140.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="178.7969" style="stroke:#000000;stroke-width:2.0;" width="508" x="10" y="140.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="408" x="25" y="153.3169">When a final state was registered (Collaborative close)</text><polygon fill="#556B2F" points="258.5,174.5156,248.5,178.5156,258.5,182.5156,254.5,178.5156" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="252.5" x2="484.5" y1="178.5156" y2="178.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="280.5" y="173.4497">Concluded Event Received.</text><polygon fill="#556B2F" points="473.5,203.6484,483.5,207.6484,473.5,211.6484,477.5,207.6484" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="247.5" x2="479.5" y1="207.6484" y2="207.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="320.5" y="202.5825">channel.Settle</text><polygon fill="#556B2F" points="258.5,247.9141,248.5,251.9141,258.5,255.9141,254.5,251.9141" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="252.5" x2="484.5" y1="251.9141" y2="251.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="259.5" y="231.7153">Channel finalized on blockchain &amp;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="312" y="246.8481">Funds withdrawn.</text><polygon fill="#00008B" points="54.5,277.0469,44.5,281.0469,54.5,285.0469,50.5,281.0469" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="48.5" x2="236.5" y1="281.0469" y2="281.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="53" y="275.981">Channel closed notification.</text><path d="M10,411.0469 L529,411.0469 L529,418.0469 L519,428.0469 L10,428.0469 L10,411.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="205.7969" style="stroke:#000000;stroke-width:2.0;" width="524" x="10" y="411.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="474" x="25" y="424.1138">When a non-final state was registered (Non Collaborative close)</text><polygon fill="#556B2F" points="258.5,445.3125,248.5,449.3125,258.5,453.3125,254.5,449.3125" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="252.5" x2="484.5" y1="449.3125" y2="449.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="280" y="444.2466">Registered Event Received.</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="247.5" x2="289.5" y1="478.4453" y2="478.4453"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="289.5" x2="289.5" y1="478.4453" y2="491.4453"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="248.5" x2="289.5" y1="491.4453" y2="491.4453"/><polygon fill="#DC143C" points="258.5,487.4453,248.5,491.4453,258.5,495.4453,254.5,491.4453" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="254.5" y="473.3794">Wait for timeout to expire.</text><polygon fill="#556B2F" points="473.5,516.5781,483.5,520.5781,473.5,524.5781,477.5,520.5781" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="247.5" x2="479.5" y1="520.5781" y2="520.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="320.5" y="515.5122">channel.Settle</text><polygon fill="#556B2F" points="258.5,545.7109,248.5,549.7109,258.5,553.7109,254.5,549.7109" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="252.5" x2="484.5" y1="549.7109" y2="549.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="314" y="544.645">Funds withdrawn</text><polygon fill="#00008B" points="54.5,574.8438,44.5,578.8438,54.5,582.8438,50.5,578.8438" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="48.5" x2="236.5" y1="578.8438" y2="578.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="53" y="573.7778">Channel closed notification.</text><!--MD5=[b9310e2a993a1392a368775c155dff31]
@startuml seq_4_settle
Title Settle Phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group When a final state was registered (Collaborative close)

perun_node <-[#DarkOliveGreen] SDK: Concluded Event Received.
activate perun_node #LightGoldenRodYellow
activate SDK #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: channel.Settle
perun_node <-[#DarkOliveGreen] SDK: Channel finalized on blockchain &\nFunds withdrawn.
user <-[#DarkBlue] perun_node: Channel closed notification.
activate user #LightGoldenRodYellow
deactivate user
deactivate perun_node
deactivate SDK

'group
end

|||
...
|||

group When a non-final state was registered (Non Collaborative close)

perun_node <-[#DarkOliveGreen] SDK: Registered Event Received.
activate SDK #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Wait for timeout to expire.
perun_node [#DarkOliveGreen]-> SDK: channel.Settle
perun_node <-[#DarkOliveGreen] SDK: Funds withdrawn
user <-[#DarkBlue] perun_node: Channel closed notification.
activate user #LightGoldenRodYellow
deactivate user
deactivate perun_node
deactivate SDK

'group
end

@enduml

@startuml seq_4_settle
Title Settle Phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group When a final state was registered (Collaborative close)

perun_node <-[#DarkOliveGreen] SDK: Concluded Event Received.
activate perun_node #LightGoldenRodYellow
activate SDK #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: channel.Settle
perun_node <-[#DarkOliveGreen] SDK: Channel finalized on blockchain &\nFunds withdrawn.
user <-[#DarkBlue] perun_node: Channel closed notification.
activate user #LightGoldenRodYellow
deactivate user
deactivate perun_node
deactivate SDK

end

|||
...
|||

group When a non-final state was registered (Non Collaborative close)

perun_node <-[#DarkOliveGreen] SDK: Registered Event Received.
activate SDK #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Wait for timeout to expire.
perun_node [#DarkOliveGreen]-> SDK: channel.Settle
perun_node <-[#DarkOliveGreen] SDK: Funds withdrawn
user <-[#DarkBlue] perun_node: Channel closed notification.
activate user #LightGoldenRodYellow
deactivate user
deactivate perun_node
deactivate SDK

end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>