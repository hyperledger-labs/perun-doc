<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1954px" preserveAspectRatio="none" style="width:730px;height:1954px;" version="1.1" viewBox="0 0 730 1954" width="730px" zoomAndPan="magnify"><defs><filter height="300%" id="f13xtsafuw1m5k" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="132" x="301" y="28.708">Transact Phase</text><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="148.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="225.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="565.375"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="916.1016"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1291.8281"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="279" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1491.4922"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="148.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="225.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="565.375"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="916.1016"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="259.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1121.0313"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="362.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1491.4922"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="237.9141"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1121.0313"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1602.0234"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1823.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="123.25" y2="397.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="397.5781" y2="425.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="425.5781" y2="812.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="812.5703" y2="840.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="840.5703" y2="1032.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="1032.6328" y2="1060.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="1060.6328" y2="1387.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="1387.9609" y2="1415.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="1415.9609" y2="1947.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="123.25" y2="397.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="397.5781" y2="425.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="425.5781" y2="812.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="812.5703" y2="840.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="840.5703" y2="1032.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="1032.6328" y2="1060.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="1060.6328" y2="1387.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="347" x2="347" y1="1387.9609" y2="1415.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="347" x2="347" y1="1415.9609" y2="1947.0234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="573" x2="573" y1="123.25" y2="397.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="573" x2="573" y1="397.5781" y2="425.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="573" x2="573" y1="425.5781" y2="812.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="573" x2="573" y1="812.5703" y2="840.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="573" x2="573" y1="840.5703" y2="1032.6328"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="573" x2="573" y1="1032.6328" y2="1060.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="573" x2="573" y1="1060.6328" y2="1387.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="573" x2="573" y1="1387.9609" y2="1415.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="573" x2="573" y1="1415.9609" y2="1947.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="40" y="119.9482">user</text><ellipse cx="58.5" cy="49.9531" fill="#FEFECE" filter="url(#f13xtsafuw1m5k)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M58.5,57.9531 L58.5,84.9531 M45.5,65.9531 L71.5,65.9531 M58.5,84.9531 L45.5,99.9531 M58.5,84.9531 L71.5,99.9531 " fill="none" filter="url(#f13xtsafuw1m5k)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="304" y="119.9482">perun node</text><ellipse cx="347.5" cy="90.9531" fill="#FEFECE" filter="url(#f13xtsafuw1m5k)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="335.5" x2="359.5" y1="104.9531" y2="104.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="556" y="119.9482">SDK</text><ellipse cx="573.5" cy="90.9531" fill="#FEFECE" filter="url(#f13xtsafuw1m5k)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="561.5" x2="585.5" y1="104.9531" y2="104.9531"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="148.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="225.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="565.375"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="916.1016"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1291.8281"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="279" style="stroke:#A80036;stroke-width:1.0;" width="10" x="53.5" y="1491.4922"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="148.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="208.7813"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="225.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="565.375"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="101.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="916.1016"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="259.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1121.0313"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="362.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342.5" y="1491.4922"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="237.9141"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1121.0313"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="53.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1602.0234"/><rect fill="#FAFAD2" filter="url(#f13xtsafuw1m5k)" height="30" style="stroke:#A80036;stroke-width:1.0;" width="10" x="568.5" y="1823.7578"/><path d="M30,140.25 L266,140.25 L266,147.25 L256,157.25 L30,157.25 L30,140.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="225.3281" style="stroke:#000000;stroke-width:2.0;" width="581" x="30" y="140.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="45" y="153.3169">Outgoing Channel Update</text><polygon fill="#00008B" points="330.5,204.7813,340.5,208.7813,330.5,212.7813,334.5,208.7813" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="208.7813" y2="208.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="102.5" y="173.4497">Send Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="188.5825">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="120" y="203.7153">&lt;SendPayChUpdateReq&gt;</text><polygon fill="#556B2F" points="556.5,233.9141,566.5,237.9141,556.5,241.9141,560.5,237.9141" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="562.5" y1="237.9141" y2="237.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="402" y="232.8481">channel.UpdateBy</text><path d="M294,252.9141 L364,252.9141 L364,259.9141 L354,269.9141 L294,269.9141 L294,252.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="307" x="294" y="252.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="309" y="265.981">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="379" y="265.1245">[if accepted by peer]</text><polygon fill="#556B2F" points="363.5,287.1797,353.5,291.1797,363.5,295.1797,359.5,291.1797" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="572.5" y1="291.1797" y2="291.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="431" y="286.1138">New state</text><polygon fill="#00008B" points="69.5,353.5781,59.5,357.5781,69.5,361.5781,65.5,357.5781" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="357.5781" y2="357.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="102.5" y="322.2466">Send Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="337.3794">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="133" y="352.5122">&lt;PayChUpdateResp&gt;</text><path d="M10,457.5781 L245,457.5781 L245,464.5781 L235,474.5781 L10,474.5781 L10,457.5781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1472.4453" style="stroke:#000000;stroke-width:2.0;" width="714" x="10" y="457.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="25" y="470.645">Incoming Channel Update</text><path d="M20,481.7109 L256,481.7109 L256,488.7109 L246,498.7109 L20,498.7109 L20,481.7109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="323.8594" style="stroke:#000000;stroke-width:2.0;" width="486.5" x="20" y="481.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="35" y="494.7778">Subscribe to Notifications</text><polygon fill="#00008B" points="330.5,561.375,340.5,565.375,330.5,569.375,334.5,565.375" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="565.375" y2="565.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="75.5" y="514.9106">Subscribe to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="530.0435">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="545.1763">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="120.5" y="560.3091">&lt;SubPayChUpdatesReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="594.5078" y2="594.5078"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="594.5078" y2="607.5078"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="607.5078" y2="607.5078"/><polygon fill="#DC143C" points="363.5,603.5078,353.5,607.5078,363.5,611.5078,359.5,607.5078" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="359.5" y="589.4419">Register Subscription</text><polygon fill="#00008B" points="74.5,678.0391,64.5,682.0391,74.5,686.0391,70.5,682.0391" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="68.5" x2="341.5" y1="682.0391" y2="682.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="75.5" y="631.5747">Subscribe to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="646.7075">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="661.8403">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="117" y="676.9731">&lt;SubPayChUpdatesResp&gt;</text><path d="M30,722.0391 L107,722.0391 L107,729.0391 L97,739.0391 L30,739.0391 L30,722.0391 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="76.5313" style="stroke:#000000;stroke-width:2.0;" width="371" x="30" y="722.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="45" y="735.106">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="122" y="734.2495">[Send Cached Notifications (if exists)]</text><polygon fill="#00008B" points="69.5,786.5703,59.5,790.5703,69.5,794.5703,65.5,790.5703" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="790.5703" y2="790.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="94.5" y="755.2388">Receive Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="167" y="770.3716">Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="133.5" y="785.5044">&lt;PayChUpdateNotif&gt;</text><path d="M30,847.5703 L304,847.5703 L304,854.5703 L294,864.5703 L30,864.5703 L30,847.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="178.0625" style="stroke:#000000;stroke-width:2.0;" width="491.5" x="30" y="847.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="229" x="45" y="860.6372">Unsubscribe from Notifications</text><polygon fill="#00008B" points="330.5,912.1016,340.5,916.1016,330.5,920.1016,334.5,916.1016" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="916.1016" y2="916.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="86.5" y="880.77">Unsub to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="895.9028">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="112.5" y="911.0356">&lt;UnsubPayChUpdatesReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="945.2344" y2="945.2344"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="945.2344" y2="958.2344"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="958.2344" y2="958.2344"/><polygon fill="#DC143C" points="363.5,954.2344,353.5,958.2344,363.5,962.2344,359.5,958.2344" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="359.5" y="940.1685">Unregister Subscription</text><polygon fill="#00008B" points="69.5,1013.6328,59.5,1017.6328,69.5,1021.6328,65.5,1017.6328" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="346.5" y1="1017.6328" y2="1017.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="86.5" y="982.3013">Unsub to Payment Channel Updates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="172" y="997.4341">Response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="109" y="1012.5669">&lt;UnsubPayChUpdatesResp&gt;</text><path d="M20,1067.6328 L192,1067.6328 L192,1074.6328 L182,1084.6328 L20,1084.6328 L20,1067.6328 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="313.3281" style="stroke:#000000;stroke-width:2.0;" width="581" x="20" y="1067.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="35" y="1080.6997">Send Notification</text><polygon fill="#556B2F" points="363.5,1117.0313,353.5,1121.0313,363.5,1125.0313,359.5,1121.0313" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="567.5" y1="1121.0313" y2="1121.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="412" y="1100.8325">UpdateHandler</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="430" y="1115.9653">(callback)</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1195.2969" y2="1195.2969"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1195.2969" y2="1208.2969"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1208.2969" y2="1208.2969"/><polygon fill="#DC143C" points="363.5,1204.2969,353.5,1208.2969,363.5,1212.2969,359.5,1208.2969" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="359.5" y="1175.0981">Push UpdateResponder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="359.5" y="1190.231">to UpdateResponders</text><path d="M30,1223.2969 L94,1223.2969 L94,1230.2969 L84,1240.2969 L30,1240.2969 L30,1223.2969 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="150.6641" style="stroke:#000000;stroke-width:2.0;" width="457.5" x="30" y="1223.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="45" y="1236.3638">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="145" x="109" y="1235.5073">[if Subscription Exists]</text><polygon fill="#00008B" points="74.5,1287.8281,64.5,1291.8281,74.5,1295.8281,70.5,1291.8281" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="68.5" x2="341.5" y1="1291.8281" y2="1291.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="94.5" y="1256.4966">Receive Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="167" y="1271.6294">Notification</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="133.5" y="1286.7622">&lt;PayChUpdateNotif&gt;</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="487.5" y1="1330.8281" y2="1330.8281"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1352.9609" y2="1352.9609"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1352.9609" y2="1365.9609"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1365.9609" y2="1365.9609"/><polygon fill="#DC143C" points="363.5,1361.9609,353.5,1365.9609,363.5,1369.9609,359.5,1365.9609" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="359.5" y="1347.895">Cache Notification</text><path d="M30,1422.9609 L252,1422.9609 L252,1429.9609 L242,1439.9609 L30,1439.9609 L30,1422.9609 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="500.0625" style="stroke:#000000;stroke-width:2.0;" width="684" x="30" y="1422.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="45" y="1436.0278">Respond To Notification</text><polygon fill="#00008B" points="330.5,1487.4922,340.5,1491.4922,330.5,1495.4922,334.5,1491.4922" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="336.5" y1="1491.4922" y2="1491.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="94.5" y="1456.1606">Receive Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="177" y="1471.2935">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="121.5" y="1486.4263">&lt;RecvPayChUpdateReq&gt;</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1535.7578" y2="1535.7578"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1535.7578" y2="1548.7578"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1548.7578" y2="1548.7578"/><polygon fill="#DC143C" points="363.5,1544.7578,353.5,1548.7578,363.5,1552.7578,359.5,1548.7578" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="359.5" y="1515.5591">Pop out UpdateResponder</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="359.5" y="1530.6919">from UpdateResponders</text><path d="M284,1563.7578 L348,1563.7578 L348,1570.7578 L338,1580.7578 L284,1580.7578 L284,1563.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="163.4688" style="stroke:#000000;stroke-width:2.0;" width="327" x="284" y="1563.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="299" y="1576.8247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="149" x="363" y="1575.9683">[if timeout not expired]</text><polygon fill="#556B2F" points="556.5,1598.0234,566.5,1602.0234,556.5,1606.0234,560.5,1602.0234" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="352.5" x2="562.5" y1="1602.0234" y2="1602.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="376" y="1596.9575">Responder.(Accept/Reject)</text><path d="M294,1617.0234 L364,1617.0234 L364,1624.0234 L354,1634.0234 L294,1634.0234 L294,1617.0234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="88.3984" style="stroke:#000000;stroke-width:2.0;" width="307" x="294" y="1617.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="309" y="1630.0903">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="66" x="379" y="1629.2339">[if Accept]</text><polygon fill="#556B2F" points="363.5,1651.2891,353.5,1655.2891,363.5,1659.2891,359.5,1655.2891" style="stroke:#556B2F;stroke-width:1.0;"/><line style="stroke:#556B2F;stroke-width:2.0;" x1="357.5" x2="572.5" y1="1655.2891" y2="1655.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="417" y="1650.2231">Updated state</text><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="394.5" y1="1684.4219" y2="1684.4219"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="394.5" x2="394.5" y1="1684.4219" y2="1697.4219"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="353.5" x2="394.5" y1="1697.4219" y2="1697.4219"/><polygon fill="#DC143C" points="363.5,1693.4219,353.5,1697.4219,363.5,1701.4219,359.5,1697.4219" style="stroke:#DC143C;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="202" x="359.5" y="1679.356">Update latest state in Channels</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="284" x2="611" y1="1713.4219" y2="1713.4219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="289" y="1723.6323">[if timeout expired]</text><polygon fill="#00008B" points="69.5,1766.4922,59.5,1770.4922,69.5,1774.4922,65.5,1770.4922" style="stroke:#00008B;stroke-width:1.0;"/><line style="stroke:#00008B;stroke-width:2.0;" x1="63.5" x2="341.5" y1="1770.4922" y2="1770.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="92" y="1750.2935">Receive Payment Channel Update</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="130.5" y="1765.4263">&lt;PayChUpdateResp&gt;</text><path d="M217,1785.4922 L287,1785.4922 L287,1792.4922 L277,1802.4922 L217,1802.4922 L217,1785.4922 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="130.5313" style="stroke:#000000;stroke-width:2.0;" width="487" x="217" y="1785.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="232" y="1798.5591">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="306" x="302" y="1797.7026">[if update was accepted and was marked Final]</text><polygon fill="#DC143C" points="556.5,1819.7578,566.5,1823.7578,556.5,1827.7578,560.5,1823.7578" style="stroke:#DC143C;stroke-width:1.0;"/><line style="stroke:#DC143C;stroke-width:2.0;" x1="352.5" x2="562.5" y1="1823.7578" y2="1823.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="375.5" y="1818.6919">Register the finalized state</text><path d="M227,1866.7578 L227,1906.7578 L690,1906.7578 L690,1876.7578 L680,1866.7578 L227,1866.7578 " fill="#D3D3D3" filter="url(#f13xtsafuw1m5k)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M680,1866.7578 L680,1876.7578 L690,1876.7578 L680,1866.7578 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="400" x="233" y="1883.8247">This operation overlaps with the Register phase of the channel.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="442" x="233" y="1898.9575">See the register phase sequence for continuation of this method call.</text><!--MD5=[084cacd91b1230ce44c1816b433500e7]
@startuml seq_2_transact
Title  Transact Phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group Outgoing Channel Update

user [#DarkBlue]-> perun_node: Send Payment Channel Update\nRequest\n<SendPayChUpdateReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: channel.UpdateBy
activate SDK #LightGoldenRodYellow
opt if accepted by peer
perun_node <-[#DarkOliveGreen] SDK: New state
deactivate SDK
'if
end
user <-[#DarkBlue] perun_node: Send Payment Channel Update\nResponse\n<PayChUpdateResp>
deactivate user
deactivate perun_node

'group
end

|||
...
|||

group Incoming Channel Update

group Subscribe to Notifications
user [#DarkBlue]-> perun_node: Subscribe to Payment Channel Updates\nRequest\nRequest\n<SubPayChUpdatesReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Register Subscription
user <-[#DarkBlue] perun_node: Subscribe to Payment Channel Updates\nResponse\nResponse\n<SubPayChUpdatesResp>
|||
loop Send Cached Notifications (if exists)
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\nNotification\n<PayChUpdateNotif>
deactivate user
deactivate perun_node

'if
end

'group
end

...

group Unsubscribe from Notifications

user [#DarkBlue]-> perun_node: Unsub to Payment Channel Updates\nRequest\n<UnsubPayChUpdatesReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Unregister Subscription
user <-[#DarkBlue] perun_node: Unsub to Payment Channel Updates\nResponse\n<UnsubPayChUpdatesResp>
deactivate user
deactivate perun_node

'group
end

...

group Send Notification
perun_node <-[#DarkOliveGreen] SDK: UpdateHandler\n(callback)
activate SDK #LightGoldenRodYellow
deactivate SDK
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Push UpdateResponder\nto UpdateResponders
alt if Subscription Exists
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\nNotification\n<PayChUpdateNotif>
activate user #LightGoldenRodYellow
deactivate user
else
perun_node [#Crimson]-> perun_node: Cache Notification
'if
end
deactivate perun_node

end
'group

...

group Respond To Notification

user [#DarkBlue]-> perun_node: Receive Payment Channel Update\nRequest\n<RecvPayChUpdateReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Pop out UpdateResponder\nfrom UpdateResponders
alt if timeout not expired
perun_node [#DarkOliveGreen]-> SDK: Responder.(Accept/Reject)
activate SDK #LightGoldenRodYellow
opt if Accept
perun_node <-[#DarkOliveGreen] SDK: Updated state
deactivate SDK
perun_node [#Crimson]-> perun_node: Update latest state in Channels

'if
end
else if timeout expired
'alt
end
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\n<PayChUpdateResp>
deactivate user

opt if update was accepted and was marked Final
perun_node [#Crimson]-> SDK: Register the finalized state
activate SDK #LightGoldenRodYellow
deactivate SDK
deactivate perun_node
note over perun_node, SDK #LightGray
This operation overlaps with the Register phase of the channel.
See the register phase sequence for continuation of this method call.
endnote
'opt
end

'group
end

'group
end

@enduml

@startuml seq_2_transact
Title  Transact Phase

actor user
entity "perun node" as perun_node
entity SDK

skinparam sequence {
    messageAlign center
    ArrowThickness 2
    BoxBorderColor Sienna
    BoxBackgroundColor SeaShell
    GroupBodyBackgroundColor transparent
    NoteTextAlignment center
    DefaultTextAlignment center
}
hide footbox

group Outgoing Channel Update

user [#DarkBlue]-> perun_node: Send Payment Channel Update\nRequest\n<SendPayChUpdateReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#DarkOliveGreen]-> SDK: channel.UpdateBy
activate SDK #LightGoldenRodYellow
opt if accepted by peer
perun_node <-[#DarkOliveGreen] SDK: New state
deactivate SDK
end
user <-[#DarkBlue] perun_node: Send Payment Channel Update\nResponse\n<PayChUpdateResp>
deactivate user
deactivate perun_node

end

|||
...
|||

group Incoming Channel Update

group Subscribe to Notifications
user [#DarkBlue]-> perun_node: Subscribe to Payment Channel Updates\nRequest\nRequest\n<SubPayChUpdatesReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Register Subscription
user <-[#DarkBlue] perun_node: Subscribe to Payment Channel Updates\nResponse\nResponse\n<SubPayChUpdatesResp>
|||
loop Send Cached Notifications (if exists)
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\nNotification\n<PayChUpdateNotif>
deactivate user
deactivate perun_node

end

end

...

group Unsubscribe from Notifications

user [#DarkBlue]-> perun_node: Unsub to Payment Channel Updates\nRequest\n<UnsubPayChUpdatesReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Unregister Subscription
user <-[#DarkBlue] perun_node: Unsub to Payment Channel Updates\nResponse\n<UnsubPayChUpdatesResp>
deactivate user
deactivate perun_node

end

...

group Send Notification
perun_node <-[#DarkOliveGreen] SDK: UpdateHandler\n(callback)
activate SDK #LightGoldenRodYellow
deactivate SDK
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Push UpdateResponder\nto UpdateResponders
alt if Subscription Exists
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\nNotification\n<PayChUpdateNotif>
activate user #LightGoldenRodYellow
deactivate user
else
perun_node [#Crimson]-> perun_node: Cache Notification
end
deactivate perun_node

end

...

group Respond To Notification

user [#DarkBlue]-> perun_node: Receive Payment Channel Update\nRequest\n<RecvPayChUpdateReq>
activate user #LightGoldenRodYellow
activate perun_node #LightGoldenRodYellow
perun_node [#Crimson]-> perun_node: Pop out UpdateResponder\nfrom UpdateResponders
alt if timeout not expired
perun_node [#DarkOliveGreen]-> SDK: Responder.(Accept/Reject)
activate SDK #LightGoldenRodYellow
opt if Accept
perun_node <-[#DarkOliveGreen] SDK: Updated state
deactivate SDK
perun_node [#Crimson]-> perun_node: Update latest state in Channels

end
else if timeout expired
end
user <-[#DarkBlue] perun_node: Receive Payment Channel Update\n<PayChUpdateResp>
deactivate user

opt if update was accepted and was marked Final
perun_node [#Crimson]-> SDK: Register the finalized state
activate SDK #LightGoldenRodYellow
deactivate SDK
deactivate perun_node
note over perun_node, SDK #LightGray
This operation overlaps with the Register phase of the channel.
See the register phase sequence for continuation of this method call.
endnote
end

end

end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>