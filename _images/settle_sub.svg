<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="670px" preserveAspectRatio="none" style="width:842px;height:670px;" version="1.1" viewBox="0 0 842 670" width="842px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ozf2i11jqgrm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" height="658.9609" style="stroke:#A80036;stroke-width:1.0;" width="300" x="39" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="171.5" y="18.0669">Alice</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="79" x="149.5" y="33.1997">(Proposer)</text><rect fill="#FFFFFF" height="658.9609" style="stroke:#A80036;stroke-width:1.0;" width="287" x="383" y="6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="512" y="18.0669">Bob</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="82" x="485.5" y="33.1997">(Proposee)</text><rect fill="#FFFFFF" filter="url(#f1ozf2i11jqgrm)" height="519.8047" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="8" y="120.1563"/><rect fill="#FFFFFF" filter="url(#f1ozf2i11jqgrm)" height="352.875" style="stroke:#000000;stroke-width:2.0;" width="776.5" x="27" y="278.0859"/><rect fill="#FFFFFF" height="126.3359" style="stroke:none;stroke-width:1.0;" width="776.5" x="27" y="504.625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="96.5" x2="96.5" y1="108.1563" y2="658.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="271.5" x2="271.5" y1="108.1563" y2="658.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="450.5" x2="450.5" y1="108.1563" y2="658.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="612.5" x2="612.5" y1="108.1563" y2="658.9609"/><rect fill="#FEFECE" filter="url(#f1ozf2i11jqgrm)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="103" x="43" y="56.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="96.5" y="76.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="50" y="92.8545">Sub-Channel</text><rect fill="#FEFECE" filter="url(#f1ozf2i11jqgrm)" height="62.8906" style="stroke:#A80036;stroke-width:1.5;" width="123" x="208" y="40.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="271.5" y="60.2607"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="247" y="76.5576">Parent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="215" y="92.8545">Ledger Channel</text><rect fill="#FEFECE" filter="url(#f1ozf2i11jqgrm)" height="62.8906" style="stroke:#A80036;stroke-width:1.5;" width="123" x="387" y="40.2656"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="450.5" y="60.2607"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="426" y="76.5576">Parent</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="394" y="92.8545">Ledger Channel</text><rect fill="#FEFECE" filter="url(#f1ozf2i11jqgrm)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="103" x="559" y="56.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="0" x="612.5" y="76.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="89" x="566" y="92.8545">Sub-Channel</text><path d="M8,120.1563 L78,120.1563 L78,127.1563 L68,137.1563 L8,137.1563 L8,120.1563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="519.8047" style="stroke:#000000;stroke-width:2.0;" width="820.5" x="8" y="120.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="23" y="133.2231">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="93" y="132.3667">[if latest off-chain state is finalized]</text><polygon fill="#A80036" points="259.5,159.4219,269.5,163.4219,259.5,167.4219,263.5,163.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="265.5" y1="163.4219" y2="163.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="124" y="158.356">Settle sub-channel</text><polygon fill="#A80036" points="461.5,159.4219,451.5,163.4219,461.5,167.4219,457.5,163.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="455.5" x2="611.5" y1="163.4219" y2="163.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="471.5" y="158.356">Settle sub-channel</text><line style="stroke:#A80036;stroke-width:1.0;" x1="271.5" x2="313.5" y1="253.0859" y2="253.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="313.5" x2="313.5" y1="253.0859" y2="266.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="313.5" y1="266.0859" y2="266.0859"/><polygon fill="#A80036" points="282.5,262.0859,272.5,266.0859,282.5,270.0859,278.5,266.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="278.5" y="187.4888">Generate an update on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="278.5" y="202.6216">the parent ledger channel</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="278.5" y="217.7544">that unlocks the funds</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="278.5" y="232.8872">for the sub-channel ID</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="278.5" y="248.02">as per final balance</text><line style="stroke:#A80036;stroke-width:1.0;" x1="450.5" x2="492.5" y1="253.0859" y2="253.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="492.5" x2="492.5" y1="253.0859" y2="266.0859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="451.5" x2="492.5" y1="266.0859" y2="266.0859"/><polygon fill="#A80036" points="461.5,262.0859,451.5,266.0859,461.5,270.0859,457.5,266.0859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="457.5" y="217.7544">Wait for the specific</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="457.5" y="232.8872">update on the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="457.5" y="248.02">parent ledger channel</text><path d="M27,278.0859 L91,278.0859 L91,285.0859 L81,295.0859 L27,295.0859 L27,278.0859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="352.875" style="stroke:#000000;stroke-width:2.0;" width="776.5" x="27" y="278.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="42" y="291.1528">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="291" x="106" y="290.2964">[update is received within expected time and</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="315" x="106" y="303.1011">other participant responds within expected time]</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="27" x2="803.5" y1="505.625" y2="505.625"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="32" y="515.8354">[else]</text><polygon fill="#A80036" points="438.5,327.9609,448.5,331.9609,438.5,335.9609,442.5,331.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="271.5" x2="444.5" y1="331.9609" y2="331.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="320" y="326.895">Send update</text><polygon fill="#A80036" points="282.5,357.0938,272.5,361.0938,282.5,365.0938,278.5,361.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="276.5" x2="449.5" y1="361.0938" y2="361.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="339" y="356.0278">Accept</text><path d="M155,374.0938 L155,414.0938 L563,414.0938 L563,384.0938 L553,374.0938 L155,374.0938 " fill="#D3D3D3" filter="url(#f1ozf2i11jqgrm)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M553,374.0938 L553,384.0938 L563,384.0938 L553,374.0938 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="387" x="161" y="391.1606">Both the participants have already finalized the sub-channel.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="161" y="406.2935">So automatically accept without involving the user.</text><polygon fill="#A80036" points="107.5,440.4922,97.5,444.4922,107.5,448.4922,103.5,444.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.5" x2="270.5" y1="444.4922" y2="444.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="115" y="439.4263">Withdrawal successful</text><polygon fill="#A80036" points="600.5,440.4922,610.5,444.4922,600.5,448.4922,604.5,444.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="450.5" x2="606.5" y1="444.4922" y2="444.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="462.5" y="439.4263">Withdrawal successful</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="138.5" y1="473.625" y2="473.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138.5" x2="138.5" y1="473.625" y2="486.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97.5" x2="138.5" y1="486.625" y2="486.625"/><polygon fill="#A80036" points="107.5,482.625,97.5,486.625,107.5,490.625,103.5,486.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="103.5" y="468.5591">Sub-channel is withdrawn</text><line style="stroke:#A80036;stroke-width:1.0;" x1="612.5" x2="654.5" y1="473.625" y2="473.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654.5" x2="654.5" y1="473.625" y2="486.625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="654.5" y1="486.625" y2="486.625"/><polygon fill="#A80036" points="623.5,482.625,613.5,486.625,623.5,490.625,619.5,486.625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="619.5" y="468.5591">Sub-channel is withdrawn</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96.5" x2="138.5" y1="555.6953" y2="555.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138.5" x2="138.5" y1="555.6953" y2="568.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97.5" x2="138.5" y1="568.6953" y2="568.6953"/><polygon fill="#A80036" points="107.5,564.6953,97.5,568.6953,107.5,572.6953,103.5,568.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="103.5" y="535.4966">Sub-channel withdrawal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="103.5" y="550.6294">failed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="612.5" x2="654.5" y1="555.6953" y2="555.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654.5" x2="654.5" y1="555.6953" y2="568.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="654.5" y1="568.6953" y2="568.6953"/><polygon fill="#A80036" points="623.5,564.6953,613.5,568.6953,623.5,572.6953,619.5,568.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="619.5" y="535.4966">Sub-channel withdrawal</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="619.5" y="550.6294">failed</text><path d="M48,581.6953 L48,621.6953 L661,621.6953 L661,591.6953 L651,581.6953 L48,581.6953 " fill="#D3D3D3" filter="url(#f1ozf2i11jqgrm)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M651,581.6953 L651,591.6953 L661,591.6953 L651,581.6953 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="199.5" y="598.7622">In this case, the sub-channel should be settled</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="199.5" y="613.895">by registering a dispute on the blockchain.</text><!--MD5=[c1375dc2fb2cd79f746b35a4f9c9546b]
@startuml settle_sub
!pragma teoz true
hide footbox
skinparam SequenceMessageAlign center

box "Alice\n(Proposer)" #transparent
participant "\nSub-Channel" as alice
participant "\nParent\nLedger Channel" as alice_parent
end box
box "Bob\n(Proposee)" #transparent
participant "\nParent\nLedger Channel" as bob_parent
participant "\nSub-Channel" as bob
end box

opt if latest off-chain state is finalized
alice -> alice_parent: Settle sub-channel
&bob -> bob_parent: Settle sub-channel

alice_parent -> alice_parent: Generate an update on\nthe parent ledger channel\nthat unlocks the funds\nfor the sub-channel ID\nas per final balance
&bob_parent -> bob_parent: Wait for the specific \nupdate on the\nparent ledger channel

alt update is received within expected time and\nother participant responds within expected time
alice_parent -> bob_parent: Send update
alice_parent <- bob_parent: Accept

note over alice_parent, bob_parent #LightGray
Both the participants have already finalized the sub-channel.
So automatically accept without involving the user.
end note

alice <- alice_parent: Withdrawal successful
&bob_parent -> bob: Withdrawal successful

alice -> alice: Sub-channel is withdrawn
&bob -> bob: Sub-channel is withdrawn

else else
alice -> alice: Sub-channel withdrawal\nfailed
&bob -> bob: Sub-channel withdrawal\nfailed
note over alice, bob #LightGray
In this case, the sub-channel should be settled
by registering a dispute on the blockchain.
end note
end
end

@enduml

PlantUML version 1.2020.21(Mon Nov 30 16:40:11 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>